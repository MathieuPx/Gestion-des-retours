<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Espace Client</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">
    <div>
      ğŸ‘¤ <strong><span id="nom"></span></strong> â€” Client
    </div>
    <button onclick="logout()">Se dÃ©connecter</button>
  </div>

  <div class="content">
    <h1>Bienvenue dans l'espace client ğŸ§¾</h1>
    <p>Email : <strong><span id="email"></span></strong></p>
    <p>NumÃ©ro client : <strong><span id="numClient"></span></strong></p>

    <h2>Mes retours</h2>
    <div id="retours"></div>
  </div>

  <script>
    const baseURL = "https://script.google.com/macros/s/AKfycbzKeKu3DQ1VqJkoOsRp3b798wi-gg0cXN39ku3yNHZWdPKfx1FQGDq99GmyLIQzYBag/exec";
    const email = localStorage.getItem("email");
    const nom = localStorage.getItem("nom");
    const role = localStorage.getItem("role");
    const numero = localStorage.getItem("numClient");

    if (!email || role !== "client") {
      window.location.href = "login.html";
    }

    document.getElementById("email").innerText = email;
    document.getElementById("nom").innerText = nom;
    document.getElementById("numClient").innerText = numero;

    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }

    function afficherRetours(retours) {
      if (!retours.length) {
        document.getElementById("retours").innerText = "Aucun retour enregistrÃ©.";
        return;
      }

      const table = document.createElement("table");
      table.style.width = "100%";
      table.style.borderCollapse = "collapse";

      const headers = Object.keys(retours[0]);
      const thead = document.createElement("thead");
      const trHead = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        th.style.borderBottom = "1px solid #e2e8f0";
        th.style.padding = "8px";
        th.style.background = "#113267";
        th.style.color = "white";
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      retours.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = row[h] || "";
          td.style.padding = "8px";
          td.style.borderBottom = "1px solid #e2e8f0";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      document.getElementById("retours").appendChild(table);
    }

    fetch(`${baseURL}?action=getRetoursClient&email=${encodeURIComponent(email)}`)
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          afficherRetours(data.retours);
        } else {
          document.getElementById("retours").innerText = "Erreur lors de la rÃ©cupÃ©ration des retours.";
        }
      })
      .catch(() => {
        document.getElementById("retours").innerText = "Erreur de connexion au serveur.";
      });
  </script>
</body>
</html>
